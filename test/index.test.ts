import { TextEncoder, TextDecoder } from 'util';
Object.assign(global, { TextDecoder, TextEncoder });

import { verify, create } from '../src';

const messageFixture = {
  "nonce": "68a1dc0c275d2c44ee5019d1ec506fe5b410c5f83853143a4d5719b0c53a2757",
  "timestamp": 1718100844
};
const proofJWTFixture =
  'eyJleHBpcmVzIjoiMjAyNC0wNi0xMVQxMDoxOTowNC41ODhaIiwibWVzc2FnZSI6IntcIm5vbmNlXCI6XCI2OGExZGMwYzI3NWQyYzQ0ZWU1MDE5ZDFlYzUwNmZlNWI0MTBjNWY4Mzg1MzE0M2E0ZDU3MTliMGM1M2EyNzU3XCIsXCJ0aW1lc3RhbXBcIjoxNzE4MTAwODQ0fSJ9.eyJkZWxlZ2F0aW9ucyI6W3siZGVsZWdhdGlvbiI6eyJwdWJrZXkiOiI3YjIyNjU3ODcwNjk3MjY1NzMyMjNhMjIzMjMwMzIzNDJkMzAzNjJkMzEzMTU0MzEzMDNhMzEzOTNhMzAzNDJlMzUzODM4NWEyMjJjMjI2ZDY1NzM3MzYxNjc2NTIyM2EyMjdiNWMyMjZlNmY2ZTYzNjU1YzIyM2E1YzIyMzYzODYxMzE2NDYzMzA2MzMyMzczNTY0MzI2MzM0MzQ2NTY1MzUzMDMxMzk2NDMxNjU2MzM1MzAzNjY2NjUzNTYyMzQzMTMwNjMzNTY2MzgzMzM4MzUzMzMxMzQzMzYxMzQ2NDM1MzczMTM5NjIzMDYzMzUzMzYxMzIzNzM1Mzc1YzIyMmM1YzIyNzQ2OTZkNjU3Mzc0NjE2ZDcwNWMyMjNhMzEzNzMxMzgzMTMwMzAzODM0MzQ3ZDIyN2QiLCJleHBpcmF0aW9uIjoiMTdkN2VkNDQ0M2Q3MWZiZSJ9LCJzaWduYXR1cmUiOiJkOWQ5ZjdhMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDU2ZGQ5ZDlmN2EzNjQ3NDcyNjU2NTgzMDE4MzAxODMwMTgyMDQ1ODIwMjY3ZDEwOGI4MjUxNDljODg5MjI3ZjIyMGNhMjAxMTM4Y2U2MjFjMzFjN2MzY2YxNzQxMTdlNzAxNTExMGJiNzgzMDI0ODYzNjE2ZTY5NzM3NDY1NzI4MzAxODMwMTgyMDQ1ODIwNjJhMTMyZWMxMDc1N2UyZWJkZmVkOGI3YmUxMzRhNTQyZGRhOTBhZmQzYjU2MDhmOGU0NWM0NzAyZDI5ZWE0MjgzMDE4MzAxODIwNDU4MjBjYTczZjUxYzMyMjYxZWZkMzJhMDY1M2E1NGI1YjcwZGY0OWVjODVmOTJiNTRlOTY1OGYyNWIwNGM4MjgyOTlhODMwMTgzMDE4MjA0NTgyMDc2Y2VkOGNmNDE0MjY1OWJlNjE2NjkzOGUyNDRlZjdmNjM5NjFkOTA1NzQzMjA1NDQyYzk4YjAzMDdlYWI2YzE4MzAxODMwMTgyMDQ1ODIwZjI0OTdiNmJkOTgxYzc0MjM3NThjOTNkMTcxOGQwNjQzNTNkNGU0NzA0NTQ2YWNjZWQwMzkyMDk2YmJjODVjZTgzMDI0YTAwMDAwMDAwMDA2MDAwN2IwMTAxODMwMTgzMDE4MzAyNGU2MzY1NzI3NDY5NjY2OTY1NjQ1ZjY0NjE3NDYxODIwMzU4MjA5ODRlMDBkNTE4ZTNiYzczODU1NGZiOGJjOTllZGI0OGM0MDJjN2NmNTliZmVhYjk1NWFkYTc2MmY1ZTZjOWM4ODIwNDU4MjA2Y2NkNmJiMzFhNTQ3NjFkNGE1NmU5Y2ZkOGNiYTM4NGQ1YjhmYjQ3MTg0ZThjYTEzY2I3MGUwNGYyMjA5YWNlODIwNDU4MjA5NmU1NTlhM2FhZTYxZWUyNGY1YjFkOWUyNmM3NzIzZjUzNGE1ZWI2NmFjMDFkYWRkYWRkNDg3ZTY5MmJmZDkwODIwNDU4MjAzYmI5NGVhODY0ZmY4ZTk2ZjcxODU2YWRhNzk4OGQxNGFmMTAxNjYxNjA0N2U0OTljODYwNWM1NzRhNTYyZjBhODIwNDU4MjAzNjc3YzMxMzhmYWVhMTYzNDUyODMzMzJmNTIyYzRlZjJiODE4NWU2MzE1NDY1ZTc1ZmQwMmE3NjZhMjEzMjViODIwNDU4MjAwNzE5NjI5YzIxN2I2NDkwNTJiMGNiNWIxMmM2NzM2ZDY1YjY0Mjg5YzU3Y2EwMDg1ZTQ5MWMwNTM4ZjAxZTViODIwNDU4MjBhMGZmYzNhOTYzY2JlZTY2YTU3MjNhNGM1ZjU4MmVlMjBjOTVhMjFiNDgzODUzYWYzNDVkYTU2OWI5Yzk0NTA1ODIwNDU4MjA4MjMyZmQwOTMwZTJmNzAwMjBkZjgxODZiNDUzZTI3MzhmYWQ1NTIwNDBmOTVkZTc5NDg4M2QyODE5ZDI5ZGVlODMwMTgyMDQ1ODIwNDBjNzZhZTVjMzk4MGEwOTNiOGM1OWE3NjEyNTgyNTQyMjY5NDg0YzM5YzM4M2I2OGU3NjYwOWE0Zjc1ODlhNjgzMDI0NDc0Njk2ZDY1ODIwMzQ5ZmViY2IwYjc5NWY0ZmFlYjE3Njk3MzY5Njc2ZTYxNzQ3NTcyNjU1ODMwOTgwMmYyMDc5M2JjYWM4MzQxMWQ1NDE2ZGY3NTExYzVjZDkwYjhjNGZjY2FmOTNkMWVjMDA5MjQwMDE0ZjQ1ZDQwNTc4ZGMzMTZmNWMyZjBlOTYxNTE1YWM2MjcwZjQyNmE2NDY1NmM2NTY3NjE3NDY5NmY2ZWEyNjk3Mzc1NjI2ZTY1NzQ1ZjY5NjQ1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDI5NGQ5ZDlmN2EyNjQ3NDcyNjU2NTgzMDE4MjA0NTgyMDgzMzYyMWJmM2IwNDExNTgyYTM2MjE2ZGJjMDBhZDk5YjE1YmRiNjZhYzMwYWU5YzBmMWJhOTUyZGMyYWY3YTk4MzAxODMwMTgyMDQ1ODIwMmVkYjhhODEzZmM1NmRlZGVhZGJlYTVkNWNkYTE0ZDQyZjMwMTg4ZTM5ZWVhYWE5NzRkNTgwYWU4NDBkNWM5MzgzMDI0NjczNzU2MjZlNjU3NDgzMDE4MzAxODMwMTgzMDE4MjA0NTgyMDg3MzlmYmJlZGQzZGVkYWE4ZmVmNDE4NzAzNjdjMDkwNWJkZTM3NmI2M2RkMzdlMmIxNzZmYjA4YjU4MjA1MmY4MzAxODIwNDU4MjBmOGMzZWFlMDM3N2VlMDA4NTkyMjNiZjFjNjIwMmY1ODg1YzRkY2RjOGZkMTNiMWQ0OGMzYzgzODY4ODkxOWJjODMwMTgzMDI1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjgzMDE4MzAyNGY2MzYxNmU2OTczNzQ2NTcyNWY3MjYxNmU2NzY1NzM4MjAzNTgzMmQ5ZDlmNzgyODI0YTAwMDAwMDAwMDA2MDAwMDAwMTAxNGEwMDAwMDAwMDAwNjAwMGFlMDEwMTgyNGEwMDAwMDAwMDAwNjAwMGIwMDEwMTRhMDAwMDAwMDAwMDZmZmZmZjAxMDE4MzAyNGE3MDc1NjI2YzY5NjM1ZjZiNjU3OTgyMDM1ODg1MzA4MTgyMzAxZDA2MGQyYjA2MDEwNDAxODJkYzdjMDUwMzAxMDIwMTA2MGMyYjA2MDEwNDAxODJkYzdjMDUwMzAyMDEwMzYxMDA5MDA3NTEyMDc3OGViMjFhNTMwYTAyYmNjNzYzZTdmNGExOTI5MzM1MDY5NjZhZjdiNTRjMTBhNGQyYjI0ZGU2YTg2YjIwMGUzNDQwYmFlNjI2N2JmNGM0ODhkOWExMWQwNDcyYzM4YzFiNjIyMTE5OGY5OGU0ZTY4ODJiYTM4YTVhNGUzYWE1YWZjZTg5OWI3ZjgyNWVkOTVhZGZhMTI2Mjk2ODgwNzM1NTZmMjc0NzUyNzIxM2U4ZDczZTQwY2U4MjA0NTgyMDM2ZjNjZDI1N2Q5MGZiMzhlNDI1OTdmMTkzYTVlMDMxZGJkNTg1YjYyOTI3OTNiYjA0ZGI0Nzk0ODAzY2UwNmU4MjA0NTgyMDQ0ODIyMzRmMGQwNmUyZmJjOGQ5ZDk3Y2ZlNDg0ZDhiMmM3ZjUwZDk4OTBiMTk0MTg5NDk0Y2UyMDcyNDA0MDc4MjA0NTgyMGI3OGUxYTAwMDExYTFiMDRjMzUwNGQxNDc0NTNmMGVkYWJiMTZiMDM2ZjYxMDdjY2I3ODMzMDM0NTI3YjBiODM4MjA0NTgyMDhlYTMwY2JjMjdmYTNiZDMyNzY2MGUyNDViNGE5OTU5Y2UyZWZmYjcyMTg3NWVmZmQzYWU2MWM1ODFiNWVmNDQ4MzAyNDQ3NDY5NmQ2NTgyMDM0OWZhYmNmMWVmOGJlMGU2ZWIxNzY5NzM2OTY3NmU2MTc0NzU3MjY1NTgzMDk5ZWVmNjM3NjE0M2Q1YjU1ZDI5NWY4YjVjNjZjMGM3ZGEwYzRlZWQ2ODNjYTdhNDFkMTliYmQ0YjJlZTZhYjQzYzk4NGNlMjkzZGU3ZGQ5Y2UwZjdiMGQ0MGE3MGYwYzY0NzQ3MjY1NjU4MzAxODIwNDU4MjA3Y2E2OGZlY2RjY2U2YjdjYzk2ZGU1MWI3N2M0ZmYwMzhkMjkxZDliMTIxMzRjODQ1NmRkZDAyZjU1Mjc0M2QyODMwMjQzNzM2OTY3ODMwMjU4MjAyZTBiNmYyY2U3Yjk4YzUzYjMxYmU2ZTVlYzY5YzJhNGVjYmMwOGM5MWEzNTViNDllYWQ0NWJhNWVhNThiMzUwODMwMjU4MjA4MjdhMWM3ZDc4YTY2YWI3NzJhODYxOWRlMjRkZGJlNjdkNTM4OTM1NThlOTgyNzQwMTA1OWNmZDVlN2EzZTYzODIwMzQwIn1dLCJwdWJsaWNLZXkiOiIzMDNjMzAwYzA2MGEyYjA2MDEwNDAxODNiODQzMDEwMjAzMmMwMDBhMDAwMDAwMDAwMDYwMDA3YjAxMDExMzBmOGQyZGQwYjJiYTQ0NDcxNjYzM2I3Y2Y3YzAxMTkzMTU4YzVhMjUwOTcyODAwYzQ0ZTY5M2YyZjkxYWMxIn0='
const currentTimeNsOverride = BigInt(1718100844);
const iiCanisterIdOverride = 'jqajs-xiaaa-aaaad-aab5q-cai'; // using a II clone on mainnet 

const expired = {
  address: 'undefined',
  proof:
    'eyJleHBpcmVzIjoiMjAyNC0wNi0xMVQyMDozMToyOS4zNjBaIiwibWVzc2FnZSI6IntcIm5vbmNlXCI6XCI2MTdkYmI5OTU3N2ExYTk4MmYxMWVmYTkzNzFmOWYxODdhZmQzZGZlNjI5ZWYzZDRiODI0Y2U1NGExODM3YjViXCIsXCJ0aW1lc3RhbXBcIjoxNzE4MTM3NTg5fSJ9.eyJkZWxlZ2F0aW9ucyI6W3siZGVsZWdhdGlvbiI6eyJwdWJrZXkiOiI3YjIyNjU3ODcwNjk3MjY1NzMyMjNhMjIzMjMwMzIzNDJkMzAzNjJkMzEzMTU0MzIzMDNhMzMzMTNhMzIzOTJlMzMzNjMwNWEyMjJjMjI2ZDY1NzM3MzYxNjc2NTIyM2EyMjdiNWMyMjZlNmY2ZTYzNjU1YzIyM2E1YzIyMzYzMTM3NjQ2MjYyMzkzOTM1MzczNzYxMzE2MTM5MzgzMjY2MzEzMTY1NjY2MTM5MzMzNzMxNjYzOTY2MzEzODM3NjE2NjY0MzM2NDY2NjUzNjMyMzk2NTY2MzM2NDM0NjIzODMyMzQ2MzY1MzUzNDYxMzEzODMzMzc2MjM1NjI1YzIyMmM1YzIyNzQ2OTZkNjU3Mzc0NjE2ZDcwNWMyMjNhMzEzNzMxMzgzMTMzMzczNTM4Mzk3ZDIyN2QiLCJleHBpcmF0aW9uIjoiMTdkODBlYjRjN2RhZmRiMSJ9LCJzaWduYXR1cmUiOiJkOWQ5ZjdhMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDU2ZGQ5ZDlmN2EzNjQ3NDcyNjU2NTgzMDE4MzAxODMwMTgyMDQ1ODIwMjY3ZDEwOGI4MjUxNDljODg5MjI3ZjIyMGNhMjAxMTM4Y2U2MjFjMzFjN2MzY2YxNzQxMTdlNzAxNTExMGJiNzgzMDI0ODYzNjE2ZTY5NzM3NDY1NzI4MzAxODMwMTgyMDQ1ODIwYTc4YmI0NDNmMTAzYTMyZjhkMTQyNjY2NTYxNzc2ZTY0ZTQ3NDk5YmQ4YzM0MmE5YzJlZTdiZDc4MWQ1ZGMxNzgzMDE4MzAxODIwNDU4MjBjYTczZjUxYzMyMjYxZWZkMzJhMDY1M2E1NGI1YjcwZGY0OWVjODVmOTJiNTRlOTY1OGYyNWIwNGM4MjgyOTlhODMwMTgzMDE4MjA0NTgyMDc2Y2VkOGNmNDE0MjY1OWJlNjE2NjkzOGUyNDRlZjdmNjM5NjFkOTA1NzQzMjA1NDQyYzk4YjAzMDdlYWI2YzE4MzAxODMwMTgyMDQ1ODIwZjI0OTdiNmJkOTgxYzc0MjM3NThjOTNkMTcxOGQwNjQzNTNkNGU0NzA0NTQ2YWNjZWQwMzkyMDk2YmJjODVjZTgzMDI0YTAwMDAwMDAwMDA2MDAwN2IwMTAxODMwMTgzMDE4MzAyNGU2MzY1NzI3NDY5NjY2OTY1NjQ1ZjY0NjE3NDYxODIwMzU4MjBmZjgyMDBjMmEzN2Y3MmU4Mjc2ODU3ZTBhMDJhMzgyMmM3ZjRlODMwMjMwMzBjMzRhZWFkMWMwY2NhMDIyZmViODIwNDU4MjA2Y2NkNmJiMzFhNTQ3NjFkNGE1NmU5Y2ZkOGNiYTM4NGQ1YjhmYjQ3MTg0ZThjYTEzY2I3MGUwNGYyMjA5YWNlODIwNDU4MjA4ZTE4ZmUxMzFkODllNDA4M2U4YmM4N2U0NTA0MzgxZmM3ZmU5ODA5NWRiMjg3MzA5ZWJiMjFjM2JkYTJjMmMxODIwNDU4MjAzYmI5NGVhODY0ZmY4ZTk2ZjcxODU2YWRhNzk4OGQxNGFmMTAxNjYxNjA0N2U0OTljODYwNWM1NzRhNTYyZjBhODIwNDU4MjAzNjc3YzMxMzhmYWVhMTYzNDUyODMzMzJmNTIyYzRlZjJiODE4NWU2MzE1NDY1ZTc1ZmQwMmE3NjZhMjEzMjViODIwNDU4MjAwNzE5NjI5YzIxN2I2NDkwNTJiMGNiNWIxMmM2NzM2ZDY1YjY0Mjg5YzU3Y2EwMDg1ZTQ5MWMwNTM4ZjAxZTViODIwNDU4MjBhMGZmYzNhOTYzY2JlZTY2YTU3MjNhNGM1ZjU4MmVlMjBjOTVhMjFiNDgzODUzYWYzNDVkYTU2OWI5Yzk0NTA1ODIwNDU4MjBiOWI1ZDFlYjU4NTk3NjFhOGU5YTVlMWEzYTI3M2RjMGMyYWM5NWFmZDI2MDdhYjhmMzQ4Zjc3ODZiMDAyNTJhODMwMTgyMDQ1ODIwMDhkOTc3YmJjMzM1ZGY1NjZhZDMwMzVhNjUxNzVjOWE5NzkzYWM4MTUxMmRlNTdjY2U2ZDEwMzNiZTA0OWQwYjgzMDI0NDc0Njk2ZDY1ODIwMzQ5YzA5NGU4ZTI5ZGEyODNlYzE3Njk3MzY5Njc2ZTYxNzQ3NTcyNjU1ODMwYTMwMDU4MzQxYjYxZjcwOTdkMjM1NTA1Y2U5ODcwYjQ4MjdmMGMxMjNlYjdjNTgxNDAyMWY5ZDA1OTE4YTRlNDE4YjU1ODg0NTY3NWM5MWVjMTE0ZDBkZTFjNTI3NTNjNmE2NDY1NmM2NTY3NjE3NDY5NmY2ZWEyNjk3Mzc1NjI2ZTY1NzQ1ZjY5NjQ1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDI5NGQ5ZDlmN2EyNjQ3NDcyNjU2NTgzMDE4MjA0NTgyMDQyNjViOTY5ZjI0ZThjYjIzY2M4MTViYmFlMzc3OWRhOTJmODY5ZDNiN2NlNTAzY2UxNTczNDE1OWUxMzNiYWU4MzAxODMwMTgyMDQ1ODIwY2IyMjgzY2MwZGIzYWJkYmJlMTExMWE5OGM3MmY2OGNlMTVhMGNjNWMzNWM3MWQxOTA1YWI1NmMzNTk0MjljODgzMDI0NjczNzU2MjZlNjU3NDgzMDE4MzAxODMwMTgzMDE4MjA0NTgyMDg3MzlmYmJlZGQzZGVkYWE4ZmVmNDE4NzAzNjdjMDkwNWJkZTM3NmI2M2RkMzdlMmIxNzZmYjA4YjU4MjA1MmY4MzAxODIwNDU4MjBmOGMzZWFlMDM3N2VlMDA4NTkyMjNiZjFjNjIwMmY1ODg1YzRkY2RjOGZkMTNiMWQ0OGMzYzgzODY4ODkxOWJjODMwMTgzMDI1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjgzMDE4MzAyNGY2MzYxNmU2OTczNzQ2NTcyNWY3MjYxNmU2NzY1NzM4MjAzNTgzMmQ5ZDlmNzgyODI0YTAwMDAwMDAwMDA2MDAwMDAwMTAxNGEwMDAwMDAwMDAwNjAwMGFlMDEwMTgyNGEwMDAwMDAwMDAwNjAwMGIwMDEwMTRhMDAwMDAwMDAwMDZmZmZmZjAxMDE4MzAyNGE3MDc1NjI2YzY5NjM1ZjZiNjU3OTgyMDM1ODg1MzA4MTgyMzAxZDA2MGQyYjA2MDEwNDAxODJkYzdjMDUwMzAxMDIwMTA2MGMyYjA2MDEwNDAxODJkYzdjMDUwMzAyMDEwMzYxMDA5MDA3NTEyMDc3OGViMjFhNTMwYTAyYmNjNzYzZTdmNGExOTI5MzM1MDY5NjZhZjdiNTRjMTBhNGQyYjI0ZGU2YTg2YjIwMGUzNDQwYmFlNjI2N2JmNGM0ODhkOWExMWQwNDcyYzM4YzFiNjIyMTE5OGY5OGU0ZTY4ODJiYTM4YTVhNGUzYWE1YWZjZTg5OWI3ZjgyNWVkOTVhZGZhMTI2Mjk2ODgwNzM1NTZmMjc0NzUyNzIxM2U4ZDczZTQwY2U4MjA0NTgyMDM2ZjNjZDI1N2Q5MGZiMzhlNDI1OTdmMTkzYTVlMDMxZGJkNTg1YjYyOTI3OTNiYjA0ZGI0Nzk0ODAzY2UwNmU4MjA0NTgyMDQ0ODIyMzRmMGQwNmUyZmJjOGQ5ZDk3Y2ZlNDg0ZDhiMmM3ZjUwZDk4OTBiMTk0MTg5NDk0Y2UyMDcyNDA0MDc4MjA0NTgyMGI3OGUxYTAwMDExYTFiMDRjMzUwNGQxNDc0NTNmMGVkYWJiMTZiMDM2ZjYxMDdjY2I3ODMzMDM0NTI3YjBiODM4MjA0NTgyMDllNTY0MWY0YWFjNDI2OGZiMjYzYjM1ZDZmOGE0Zjc1MzQzMGNiOWZlYWQ2MjBkYzdjZjY3NmY3NjJiZjAwNTg4MzAyNDQ3NDY5NmQ2NTgyMDM0OWRmODBhZmI4ODdlMGU2ZWIxNzY5NzM2OTY3NmU2MTc0NzU3MjY1NTgzMDgyZmI1MTEyMTY1Zjg1OTk4MjE1NGI1MjYyYWQyNDk2YTQ4OTYzY2ZjYzlhZDkyZTI2Yjc5ZjQ2MTk2ZjlhZGZkNzA3ODQxYTg2NzY1MzEzNTc3NzAzMDI2NmQ4Y2M0ZTY0NzQ3MjY1NjU4MzAxODIwNDU4MjAyNDkyYmMwNDBlNjI0MDNiYWQ5MWM5MTcwYzk3ZjI4MWE0N2FlOTJiN2E5NWQ0ZGYwNzRmNDIzYjA2MGYzNjM5ODMwMjQzNzM2OTY3ODMwMjU4MjAyYzFhYmVjZmRkMTEwODA4MGQzNDBlMDZkYmY1OTEyY2M4NmEwNjlmNTc3NzU1MTVjM2YyNjBmMGU0Yzk1ZWM4ODMwMTgyMDQ1ODIwYzI5NzE3YjkzZTY0ZjQ5MTQ1MjNiMmMzZTQ4MjI1NzJlYTIyYzgxYmY5MGIyMDQ0NDIzMmIyYWU3OTZkYWQwOTgzMDI1ODIwOWU4ZGM3ZGEzYzQ2OTc5ZmQ4MWYzNWQ5ODIwODdjOWU5ZDU3NmRhZmE5NmQ4NTIxNGM3OWRhNDJkMmI1NDk3YjgyMDM0MCJ9XSwicHVibGljS2V5IjoiMzAzYzMwMGMwNjBhMmIwNjAxMDQwMTgzYjg0MzAxMDIwMzJjMDAwYTAwMDAwMDAwMDA2MDAwN2IwMTAxYTYyZDk0MWIyZDYxNjdiNzM1MDE2OTU4Y2VhNmRkODIxZGY4YjJmY2FlMDYwNzQ0NTBkMjg5MmJhZDExNDNjMCJ9'
};

describe('prove-icp-principal', () => {
  afterEach(() => jest.restoreAllMocks());

  let message: string;
  beforeEach(() => {
    message = JSON.stringify(messageFixture);
  });

  it('creates a wallet ownership proof when a signer function is provided', async () => {
    // const proof = await create({
    //   message,
    // });
    // expect(proof).toMatch(/.*\..*/); // the message is a base64 version of the signature concatenated with the message
  });

  it('verifies wallet ownership with provided signer function', async () => {
    await expect(verify('undefined', proofJWTFixture, { message }, currentTimeNsOverride, iiCanisterIdOverride)).resolves.not.toThrow();
  });

  // it('throws an error if the transaction is signed with a different key', async () => {
  //   await expect(verify(someOtherKey.address, proof, { message })).rejects.toThrow();
  // });

  it('throws an error if the proof is expired', async () => {
    await expect(verify(expired.address, expired.proof, { message: 'test' }, undefined, iiCanisterIdOverride)).rejects.toThrow('Token Expired');
  });

  it("throws an error if the message doesn't match", async () => {
    await expect(verify('undefined', proofJWTFixture, { message: 'wrong' }, currentTimeNsOverride, iiCanisterIdOverride)).rejects.toThrow('Bad message');
  });
});